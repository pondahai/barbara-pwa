# Barbara AI Assistant (PWA 版本)

**版本:** (PWA 版本號，例如 1.0)

Barbara AI Assistant (PWA) 是一款漸進式網頁應用程式 (Progressive Web App)，旨在提供一個獨立、可安裝的介面，讓使用者可以方便地與自訂的大型語言模型 (LLM) API 進行互動。它核心功能包括 AI 聊天、對話管理以及 API 設定管理。

此 PWA 版本脫離了 Chrome 擴充功能的限制，可以在支援 PWA 的現代瀏覽器中獨立運行，並可「安裝」到桌面或行動裝置主畫面，提供更接近原生應用的體驗。

## 主要功能

*   **AI 聊天介面:**
    *   與使用者設定的 LLM 模型進行即時對話。
    *   支援 Markdown 格式渲染 AI 的回覆。
    *   **處理 AI 思考過程:** 如果 LLM 回應中包含由 `<think>...</think>` 標籤包裹的思考過程，這些內容會被提取並顯示為一個獨立的、可折疊的對話項，預設收起。
    *   串流回覆：AI 的回覆會以串流方式即時顯示。
    *   程式碼塊一鍵複製。
*   **對話管理:**
    *   複製單則對話內容（包括普通回應和思考過程）。
    *   刪除單則對話（包括普通回應和思考過程）。
    *   一鍵刪除當前選定設定檔下的所有對話記錄。
*   **API 設定管理:**
    *   支援儲存和管理多組 LLM API 的連線設定。
    *   每組設定包含 API 網址 (API URL) 和 API 金鑰 (API Key)。
    *   設定 API 後，可從該 API 獲取可用的模型列表並進行選擇。
*   **PWA 特性:**
    *   **可安裝：** 可以被「新增到主畫面」(行動裝置) 或「安裝」(桌面瀏覽器)，像獨立應用程式一樣啟動。
    *   **離線 UI 存取：** 應用程式介面 (HTML, CSS, JS, 圖示) 被快取，即使在離線狀態下，使用者仍可開啟應用並查看已有的設定和對話記錄 (核心 AI 功能仍需網路)。
    *   **響應式設計：** 盡力適應不同螢幕尺寸 (雖然主要優化目標可能是桌面/平板)。
*   **剪貼簿輔助功能:**
    *   **剪貼簿摘要:** 快速將剪貼簿中的文字內容填入輸入框並生成摘要提示詞。
    *   **剪貼簿翻譯:** 快速將剪貼簿中的文字內容填入輸入框並生成翻譯提示詞 (會根據內容語言自動判斷目標語言，或翻譯成英文)。

## 技術棧

*   **前端：** HTML, CSS, Vanilla JavaScript
*   **Markdown 渲染：** `marked.js`
*   **PWA 核心：**
    *   Web App Manifest (`manifest.webmanifest`)
    *   Service Worker (`sw.js`) - 用於快取應用程式外殼和靜態資源。
*   **本地儲存：** 使用瀏覽器的 `localStorage` 儲存 API 設定和對話歷史。

## 如何部署與使用

### 部署 PWA

1.  **準備環境：** 確保您的開發環境已安裝 Node.js 和 npm (用於本地測試伺服器，可選)。
2.  **獲取程式碼：** 下載或克隆本 PWA 專案的原始碼。
3.  **檢查資源路徑：**
    *   確保 `manifest.webmanifest` 中的 `start_url`, `icons[].src` 路徑正確。
    *   確保 `sw.js` 中的 `urlsToCache` 數組包含所有需要快取的資源 (HTML, CSS, JS, 圖片)，且路徑正確。
    *   確保 `index.html` 和 `settings.html` 中對 CSS, JS, Manifest 的連結路徑正確。
    *   **特別注意：** 如果部署到子目錄 (例如 GitHub Pages 的 `https://<username>.github.io/<repository>/`)，所有這些路徑都需要是相對於該子目錄的，或者使用正確的絕對路徑。
4.  **準備圖示：** 根據 `manifest.webmanifest` 中 `icons` 陣列的定義，準備相應尺寸的圖示檔案，並放置在 `images/` 資料夾下。
5.  **選擇部署平台 (必須支援 HTTPS)：**
    *   **推薦靜態網站託管服務：**
        *   **GitHub Pages:** 免費，與 Git 集成。將專案作為 GitHub 倉庫，並啟用 Pages。
        *   **Netlify / Vercel / Cloudflare Pages:** 提供免費方案，易於部署，自動 HTTPS。
        *   **Firebase Hosting:** Google 服務，免費方案，快速 CDN。
    *   **自有伺服器：** 如果您有自己的 Web 伺服器，確保已配置 HTTPS。
6.  **部署檔案：** 將專案的所有檔案上傳到您選擇的託管平台。
7.  **獲取 PWA 的 HTTPS URL。**

### 本地測試

1.  在專案根目錄下，使用一個本地 HTTP 伺服器。例如，使用 `http-server`：
    ```bash
    npm install -g http-server # 如果尚未安裝
    cd path/to/barbara-pwa
    http-server -c-1
    ```
2.  在瀏覽器中打開伺服器提供的本地網址 (例如 `http://localhost:8080`)。
3.  使用瀏覽器開發者工具 (F12) 的 "Application" 標籤頁檢查：
    *   Manifest 是否正確載入且無錯誤。
    *   Service Worker 是否已註冊、激活並正在運行。
    *   Cache Storage 是否已快取指定的資源。
    *   嘗試模擬離線並重新整理頁面，看 UI 是否仍能顯示。

### 安裝 PWA

1.  使用現代瀏覽器 (如 Chrome, Edge, Safari) 透過 **HTTPS** 訪問已部署的 PWA URL。
2.  與 PWA 頁面進行一些互動 (例如點擊)。
3.  **桌面瀏覽器：** 通常會在網址列右側出現一個「安裝」圖示。點擊該圖示並確認安裝。
4.  **行動裝置瀏覽器：**
    *   **Android (Chrome)：** 可能會自動彈出「新增到主畫面」的提示，或在瀏覽器選單中找到「安裝應用程式」/「新增到主畫面」選項。
    *   **iOS (Safari)：** 點擊分享按鈕，然後選擇「加入主畫面」。
5.  安裝完成後，PWA 會像一個獨立應用程式一樣出現在您的桌面或主畫面上。

## 使用 PWA

1.  **首次設定：**
    *   打開已安裝的 Barbara PWA 或直接訪問其 URL。
    *   導航到「設定」頁面。
    *   輸入您的 LLM API 的「API 網址」和「API 金鑰」。
    *   點擊「取得模型列表」以載入可用模型。
    *   從下拉選單中「選擇模型」。
    *   點擊「儲存此設定」。您可以儲存多組設定。
2.  **聊天：**
    *   返回「聊天」主頁面。
    *   從「選擇設定」下拉選單中選擇一個已儲存的 API 設定。
    *   在底部的輸入框中輸入您想與 AI 對話的內容。
    *   點擊「送出」或按下 `Ctrl + Enter`。
    *   AI 的回覆（包括可能的思考過程）將顯示在對話列表中。
3.  **其他操作：**
    *   使用對話項目旁邊的按鈕複製或刪除單則訊息。
    *   使用對話列表右上角的「X」按鈕刪除當前設定下的所有對話。
    *   使用「剪貼簿摘要/翻譯」按鈕快速處理剪貼簿內容。

## 注意事項

*   **API 金鑰安全：** API 金鑰儲存在瀏覽器的 `localStorage` 中。請確保您的裝置和瀏覽器環境安全。
*   **網路連線：** 核心的 AI 聊天、摘要、翻譯功能依賴於正常的網路連線至您設定的 LLM API 端點。
*   **CORS 問題：** 確保您使用的 LLM API 伺服器允許來自 PWA 部署網域的跨域請求 (CORS)。
*   **圖示：** 為了獲得最佳的安裝和視覺體驗，請確保 `images/` 目錄下包含 `manifest.webmanifest` 中引用的所有尺寸的圖示。

---

